<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Relat√≥rio de Despesas - Babylon Delicatessen</title>
  <style>
    /* Estilo neon azul */
    body {
      background-color: #000;
      color: #0ff;
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
      text-shadow: 0 0 10px #0ff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #0ff;
      padding: 8px;
      text-align: left;
    }
    th {
      text-shadow: 0 0 5px #0ff;
    }
    a {
      color: #0ff;
      text-decoration: none;
      font-size: 1.5em;
    }
    a:hover {
      text-shadow: 0 0 10px #0ff;
    }
  </style>
</head>
<body>
  <h1>Relat√≥rio de Despesas - Babylon Delicatessen</h1>
  <div id="table-container"></div>

  <script>
    // URL do CSV (obtida a partir da publica√ß√£o da planilha no modo CSV)
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSXuHtwXJyCycBXp61Lf-_Q17NY-p7bo_V-e2HrC_G2XI8r7DLZDaCQEUcnuqq7bSST4gLrJsJwtOWU/pub?gid=1163522917&single=true&output=csv";

    // Fun√ß√£o simples para converter CSV em array de arrays
    function parseCSV(text) {
      const lines = text.split("\n").filter(line => line.trim() !== "");
      return lines.map(line => {
        // Esta implementa√ß√£o simples sup√µe que os dados n√£o contenham v√≠rgulas internas
        return line.split(",").map(item => item.replace(/^"|"$/g, '').trim());
      });
    }

    fetch(csvUrl)
      .then(response => response.text())
      .then(data => {
        const allRows = parseCSV(data);

        // Verifica se h√° linhas suficientes
        if(allRows.length < 2) {
          document.getElementById('table-container').innerHTML = "Dados insuficientes.";
          return;
        }
        // Desconsidera a primeira linha e usa a segunda como cabe√ßalho
        const header = allRows[1];
        const dataRows = allRows.slice(2);

        // Identifica os √≠ndices das colunas de upload
        const idxComprovante = header.indexOf("Anexar Comprovante de Pagamento (Upload de arquivo)");
        const idxRecibo = header.indexOf("Anexar Recibo ou Nota Fiscal (Upload de arquivo)");

        let html = "<table>";
        // Gera√ß√£o do cabe√ßalho
        html += "<tr>";
        header.forEach(col => {
          html += "<th>" + col + "</th>";
        });
        html += "</tr>";

        // Gera√ß√£o das linhas de dados
        dataRows.forEach(row => {
          // Completa com c√©lulas vazias caso a linha esteja incompleta
          if (row.length < header.length) {
            row = row.concat(new Array(header.length - row.length).fill(""));
          }
          html += "<tr>";
          row.forEach((cell, index) => {
            // Se for uma das colunas de upload e houver link, substitui pelo emoji clic√°vel
            if ((index === idxComprovante || index === idxRecibo) && cell !== "") {
              cell = '<a href="' + cell + '" download title="Download"><span>üì•</span></a>';
            }
            html += "<td>" + cell + "</td>";
          });
          html += "</tr>";
        });
        html += "</table>";

        document.getElementById('table-container').innerHTML = html;
      })
      .catch(error => {
        console.error("Erro ao carregar os dados: ", error);
        document.getElementById('table-container').innerHTML = "Erro ao carregar os dados.";
      });
  </script>
</body>
</html>
